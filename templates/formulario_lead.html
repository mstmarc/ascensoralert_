<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulario Lead</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='favicon.png') }}">
    <link rel="stylesheet" href="/static/styles.css?v=5">
    <style>
        /* HEADER CENTRADO */
        header .header-container {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        header .logo-container {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .botones-form { display: flex; gap: 10px; margin-top: 20px; }
        .menu-toggle { display: none; position: fixed; top: 20px; right: 20px; z-index: 1000; background: #366092; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; font-size: 20px; }
        .menu-lateral { display: none; position: fixed; top: 0; right: -300px; width: 250px; height: 100%; background: #2c3e50; z-index: 999; transition: right 0.3s ease; padding-top: 60px; box-shadow: -2px 0 5px rgba(0,0,0,0.3); }
        .menu-lateral.active { right: 0; }
        .menu-lateral a { display: block; color: white; padding: 15px 20px; text-decoration: none; border-bottom: 1px solid rgba(255,255,255,0.1); transition: background 0.3s; }
        .menu-lateral a:hover { background: rgba(255,255,255,0.1); }

        /* Ajustar contenedor del dashboard para ancho completo */
        main {
            max-width: none !important;
            padding: 30px !important;
        }

        main .menu {
            max-width: none !important;
            width: 100% !important;
            margin: 0 !important;
        }

        .container {
            max-width: 700px;
            margin: 20px auto;
            padding: 0 15px;
        }

        h2 {
            font-size: 20px;
            color: #366092;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #366092;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            color: #555;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            font-family: 'Montserrat', sans-serif;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #366092;
            box-shadow: 0 0 0 3px rgba(54, 96, 146, 0.1);
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .required {
            color: red;
        }

        .form-actions {
            display: flex;
            gap: 10px;
            margin-top: 25px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            text-align: center;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: #366092;
            color: white;
        }

        .btn-primary:hover {
            background: #2a4d73;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        @media (max-width: 768px) { .menu-toggle { display: block; } .menu-lateral { display: block; } }
    </style>
</head>
<body>
    <button class="menu-toggle" onclick="toggleMenu()">‚ò∞</button>
    <nav class="menu-lateral" id="menuLateral">
        <a href="/home">Inicio</a>
        <a href="/leads_dashboard">Ver Comunidades</a>
        <a href="/administradores_dashboard">Administradores de Fincas</a>
        <a href="/visitas_administradores_dashboard">Ver Visitas Administradores</a>
        <a href="/oportunidades">Oportunidades</a>
        <a href="/reporte_mensual">Descargo Comercial</a>
        <a href="/logout">Cerrar Sesi√≥n</a>
    </nav>
    
    <header>
    <div class="header-container">
        <div class="logo-container">
            <a href="/home">
                <img src="/static/logo-fedes-ascensores.png" alt="Logo Fedes Ascensores" class="logo">
            </a>
        </div>
        </div>
</header>
    <main>
        <div class="container">
            <h2>Datos de la Visita a Instalaci√≥n</h2>

            <form method="POST">
                    <div class="form-group">
                        <label for="fecha_visita">Fecha de Visita <span class="required">*</span></label>
                        <input type="date" id="fecha_visita" name="fecha_visita" value="{{ fecha_hoy }}" required>
                    </div>

                    <div class="form-group">
                        <label for="tipo_lead">Tipo de Lead</label>
                        <select id="tipo_lead" name="tipo_lead">
                            <option value="">-- Selecciona un tipo --</option>
                            <option value="Comunidad">Comunidad</option>
                            <option value="Hotel/Apartamentos">Hotel/Apartamentos</option>
                            <option value="Empresa">Empresa</option>
                            <option value="Otro">Otro</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="direccion">Direcci√≥n <span class="required">*</span></label>
                        <input type="text" id="direccion" name="direccion" required>
                    </div>

                    <div class="form-group">
                        <label for="nombre_lead">Nombre de la Instalaci√≥n</label>
                        <input type="text" id="nombre_lead" name="nombre_lead">
                    </div>

                    <div class="form-group">
                        <label for="codigo_postal">C√≥digo Postal</label>
                        <input type="text" id="codigo_postal" name="codigo_postal">
                    </div>

                    <div class="form-group">
                        <label for="localidad">Localidad <span class="required">*</span></label>
                        <select id="localidad" name="localidad" required>
                    <option value="">-- Selecciona una localidad --</option>
                    <option value="Agaete">Agaete</option>
                    <option value="Ag√ºimes">Ag√ºimes</option>
                    <option value="Arguinegu√≠n">Arguinegu√≠n</option>
                    <option value="Arinaga">Arinaga</option>
                    <option value="Artenara">Artenara</option>
                    <option value="Arucas">Arucas</option>
                    <option value="Carrizal">Carrizal</option>
                    <option value="Cruce de Arinaga">Cruce de Arinaga</option>
                    <option value="Cruce de Melenara">Cruce de Melenara</option>
                    <option value="Cruce de Sardina">Cruce de Sardina</option>
                    <option value="El Burrero">El Burrero</option>
                    <option value="El Tablero">El Tablero</option>
                    <option value="Firgas">Firgas</option>
                    <option value="G√°ldar">G√°ldar</option>
                    <option value="Ingenio">Ingenio</option>
                    <option value="Jin√°mar">Jin√°mar</option>
                    <option value="La Aldea de San Nicol√°s">La Aldea de San Nicol√°s</option>
                    <option value="La Pardilla">La Pardilla</option>
                    <option value="Las Palmas de Gran Canaria">Las Palmas de Gran Canaria</option>
                    <option value="Maspalomas">Maspalomas</option>
                    <option value="Melenara">Melenara</option>
                    <option value="Mog√°n">Mog√°n</option>
                    <option value="Moya">Moya</option>
                    <option value="Playa de Mog√°n">Playa de Mog√°n</option>
                    <option value="Playa del Ingl√©s">Playa del Ingl√©s</option>
                    <option value="Puerto Rico">Puerto Rico</option>
                    <option value="Salinetas">Salinetas</option>
                    <option value="San Bartolom√© de Tirajana">San Bartolom√© de Tirajana</option>
                    <option value="San Fernando">San Fernando</option>
                    <option value="San Mateo">San Mateo</option>
                    <option value="Santa Br√≠gida">Santa Br√≠gida</option>
                    <option value="Santa Luc√≠a de Tirajana">Santa Luc√≠a de Tirajana</option>
                    <option value="Santa Mar√≠a de Gu√≠a">Santa Mar√≠a de Gu√≠a</option>
                    <option value="Sardina del Norte">Sardina del Norte</option>
                    <option value="Tafira">Tafira</option>
                    <option value="Tejeda">Tejeda</option>
                    <option value="Telde">Telde</option>
                    <option value="Teror">Teror</option>
                    <option value="Valleseco">Valleseco</option>
                    <option value="Valsequillo">Valsequillo</option>
                            <option value="Vecindario">Vecindario</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="administrador_search">Administrador de Fincas</label>
                        <input
                            type="text"
                            id="administrador_search"
                            list="administradores-list"
                            placeholder="üîç Buscar administrador..."
                            autocomplete="off"
                        >
                        <datalist id="administradores-list">
                            {% for admin in administradores %}
                            <option value="{{ admin.nombre_empresa }}" data-id="{{ admin.id }}">
                            {% endfor %}
                        </datalist>
                        <input type="hidden" id="administrador_id" name="administrador_id">
                        <small style="color: #666; font-size: 12px; display: block; margin-top: 5px;">
                            üí° Escribe para buscar o selecciona de la lista
                        </small>
                    </div>

                    <div class="form-group">
                        <label for="numero_ascensores">N√∫mero de Ascensores</label>
                        <select id="numero_ascensores" name="numero_ascensores">
                    <option value="">-- Cuantos ascensores hay? --</option>
                    <option value="1">1 ascensor</option>
                    <option value="2">2 ascensores</option>
                    <option value="3">3 ascensores</option>
                    <option value="4">4 ascensores</option>
                    <option value="5">5 ascensores</option>
                    <option value="6">6 ascensores</option>
                    <option value="7">7 ascensores</option>
                    <option value="8">8 ascensores</option>
                    <option value="9">9 ascensores</option>
                    <option value="10">10 ascensores</option>
                    <option value="11">11 ascensores</option>
                    <option value="12">12 ascensores</option>
                    <option value="13">13 ascensores</option>
                    <option value="14">14 ascensores</option>
                    <option value="15">15 ascensores</option>
                    <option value="16">16 ascensores</option>
                    <option value="17">17 ascensores</option>
                    <option value="18">18 ascensores</option>
                    <option value="19">19 ascensores</option>
                            <option value="20">20 ascensores</option>
                            <option value="20+">M√°s de 20 ascensores</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="empresa_mantenedora">Empresa Mantenedora Actual</label>
                        <select id="empresa_mantenedora" name="empresa_mantenedora">
                    <option value="">-- Selecciona una empresa --</option>
                    <option value="FAIN Ascensores">FAIN Ascensores</option>
                    <option value="KONE">KONE</option>
                    <option value="Otis">Otis</option>
                    <option value="Schindler">Schindler</option>
                    <option value="TKE">TKE</option>
                    <option value="Orona">Orona</option>
                    <option value="APlus Ascensores">APlus Ascensores</option>
                    <option value="Ascensores Canarias">Ascensores Canarias</option>
                    <option value="Ascensores Domingo">Ascensores Domingo</option>
                    <option value="Ascensores Vulcano Canarias">Ascensores Vulcano Canarias</option>
                    <option value="Elevadores Canarios">Elevadores Canarios</option>
                    <option value="Fedes Ascensores">Fedes Ascensores</option>
                    <option value="Gratecsa">Gratecsa</option>
                    <option value="Lift Technology">Lift Technology</option>
                    <option value="Omega Elevadores">Omega Elevadores</option>
                            <option value="Q Ascensores">Q Ascensores</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="fecha_fin_contrato">Fecha de Fin de Contrato</label>
                        <input type="date" id="fecha_fin_contrato" name="fecha_fin_contrato">
                        <small style="color: #666; font-size: 12px; display: block; margin-top: 5px;">
                            üìÖ Dato muy valioso para seguimiento comercial (120 d√≠as antes se crea tarea abierta)
                        </small>
                    </div>

                    <div class="form-group">
                        <label for="paradas">Paradas</label>
                        <input type="number" id="paradas" name="paradas" min="0" placeholder="N√∫mero de paradas">
                    </div>

                    <div class="form-group">
                        <label for="viviendas_por_planta">Viviendas por Planta</label>
                        <input type="number" id="viviendas_por_planta" name="viviendas_por_planta" min="0" placeholder="N√∫mero de viviendas por planta">
                    </div>

                    <div class="form-group">
                        <label for="persona_contacto">Persona de Contacto</label>
                        <input type="text" id="persona_contacto" name="persona_contacto">
                    </div>

                    <div class="form-group">
                        <label for="telefono">Tel√©fono</label>
                        <input type="text" id="telefono" name="telefono">
                    </div>

                    <div class="form-group">
                        <label for="email">Email</label>
                        <input type="email" id="email" name="email">
                    </div>

                    <div class="form-group">
                        <label for="observaciones">Observaciones</label>
                        <textarea id="observaciones" name="observaciones"></textarea>
                    </div>

                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Registrar Lead</button>
                    <a href="/home" class="btn btn-secondary">Volver</a>
                </div>
            </form>
        </div>
    </main>
    
    <script>
        function toggleMenu() {
            document.getElementById('menuLateral').classList.toggle('active');
        }

        document.addEventListener('click', function(event) {
            const menu = document.getElementById('menuLateral');
            const toggle = document.querySelector('.menu-toggle');
            if (!menu.contains(event.target) && !toggle.contains(event.target)) {
                menu.classList.remove('active');
            }
        });

        // Script para capturar el ID del administrador seleccionado
        const searchInput = document.getElementById('administrador_search');
        const hiddenInput = document.getElementById('administrador_id');
        const datalist = document.getElementById('administradores-list');

        if (searchInput && hiddenInput && datalist) {
            searchInput.addEventListener('input', function() {
                const selectedOption = Array.from(datalist.options).find(
                    option => option.value === this.value
                );

                if (selectedOption) {
                    hiddenInput.value = selectedOption.dataset.id;
                    console.log('Administrador seleccionado:', this.value, 'ID:', selectedOption.dataset.id);
                } else {
                    hiddenInput.value = '';
                }
            });
        }
    </script>    <!-- Inyectar permisos del usuario para JavaScript -->
    <script>
        window.userPermissions = {{ permisos_usuario_json | safe }};
        window.perfilUsuario = '{{ perfil_usuario }}';
    </script>

<script src="/static/sidebar.js"></script>
</body>
</html>
