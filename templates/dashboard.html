<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Leads - AscensorAlert</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='favicon.png') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}?v=9">
    <link rel="stylesheet" href="{{ url_for('static', filename='components.css') }}?v=1">
</head>
<body>
    <header>
        <div class="header-container">
            <div class="logo-container">
                <a href="/home">
                    <img src="{{ url_for('static', filename='logo-fedes-ascensores.png') }}" alt="Logo Fedes Ascensores" class="logo">
                </a>
            </div>
        </div>
    </header>

    <main class="main--full-width">
        <div class="page-container">
            <!-- Header de p치gina con t칤tulo y bot칩n -->
            <div class="page-header">
                <div class="page-header__left">
                    <h1>Gesti칩n de Instalaciones</h1>
                </div>
                <a href="/nuevo_lead" class="btn btn--primary btn--rounded">
                    + Nueva Instalaci칩n
                </a>
            </div>

            <form method="GET" action="{{ url_for('leads.dashboard') }}">
                <div class="buscador-destacado">
                    <div class="buscador-label">Buscar por Direccion</div>
                    <div class="buscador-input-container">
                        <input
                            type="text"
                            name="buscar_direccion"
                            class="buscador-input"
                            value="{{ buscar_direccion }}"
                            placeholder="Ej: Calle Mayor, Avenida..."
                            autofocus
                        >
                        <button type="submit" class="btn-buscar">Buscar</button>
                    </div>
                </div>

                <div class="filtros">
                    <div class="filtros-grid">
                        <div class="filtro-grupo">
                            <label>Localidad:</label>
                            <select name="localidad">
                                <option value="">Todas</option>
                                {% for loc in localidades %}
                                <option value="{{ loc }}" {% if filtro_localidad == loc %}selected{% endif %}>{{ loc }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <div class="filtro-grupo">
                            <label>Mantenedora:</label>
                            <select name="empresa">
                                <option value="">Todas</option>
                                {% for emp in empresas %}
                                <option value="{{ emp }}" {% if filtro_empresa == emp %}selected{% endif %}>{{ emp }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <div class="filtro-grupo">
                            <label>&nbsp;</label>
                            <button type="submit" class="btn btn--primary btn--rounded">
                                Filtrar
                            </button>
                        </div>

                        <div class="filtro-grupo">
                            <label>&nbsp;</label>
                            <a href="{{ url_for('leads.dashboard') }}" class="btn btn--secondary btn--rounded">
                                Limpiar
                            </a>
                        </div>

                        <div class="filtro-grupo">
                            <label>&nbsp;</label>
                            <a href="{{ url_for('leads.exportar', localidad=filtro_localidad, empresa=filtro_empresa, buscar_direccion=buscar_direccion) }}" class="btn btn--success btn--rounded">
                                游늵 Excel
                            </a>
                        </div>
                    </div>
                </div>

                <input type="hidden" name="page" value="1">
            </form>

            <!-- Listado de Instalaciones -->
            {% if rows %}
                <div class="recent-list">
                    {% for row in rows %}
                    <div class="recent-item">
                        <a href="{{ url_for('leads.ver', lead_id=row.lead_id) }}" class="recent-item__title text-center">
                            {{ row.direccion }}
                        </a>
                        <div class="recent-item__meta justify-center">
                            <span class="recent-item__meta-item">{{ row.localidad }}</span>
                            <span class="recent-item__meta-item">Ascensores: {{ row.total_equipos }}</span>
                            <span class="recent-item__meta-item">{{ row.empresa_mantenedora }}</span>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="estado-vacio">
                    No se encontraron comunidades con los filtros aplicados
                </div>
            {% endif %}

            <div class="info-resultados">
                Mostrando {{ rows|length }} registros de {{ total_registros }} totales
            </div>

            <div class="paginacion">
                {% if page > 1 %}
                    <a href="?page={{ page - 1 }}&localidad={{ filtro_localidad }}&empresa={{ filtro_empresa }}&buscar_direccion={{ buscar_direccion }}" class="btn btn--primary btn--sm btn--rounded">Anterior</a>
                {% else %}
                    <button class="btn btn--primary btn--sm btn--rounded" disabled>Anterior</button>
                {% endif %}

                <span class="paginacion-info">P치gina {{ page }} de {{ total_pages }}</span>

                {% if page < total_pages %}
                    <a href="?page={{ page + 1 }}&localidad={{ filtro_localidad }}&empresa={{ filtro_empresa }}&buscar_direccion={{ buscar_direccion }}" class="btn btn--primary btn--sm btn--rounded">Siguiente</a>
                {% else %}
                    <button class="btn btn--primary btn--sm btn--rounded" disabled>Siguiente</button>
                {% endif %}
            </div>

            <div class="mt-2xl">
                <a href="/home" class="btn btn--secondary btn--rounded">Volver al Home</a>
            </div>
        </div>
    </main>

    <script>
        window.userPermissions = {{ permisos_usuario_json | safe }};
        window.perfilUsuario = '{{ perfil_usuario }}';
    </script>
    <script src="{{ url_for('static', filename='sidebar.js') }}"></script>
</body>
</html>
