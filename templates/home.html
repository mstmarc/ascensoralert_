<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inicio</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='favicon.png') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}?v=9">
    <link rel="stylesheet" href="{{ url_for('static', filename='components.css') }}?v=3">
</head>
<body>
    <header>
        <div class="header-container">
            <div class="logo-container">
                <a href="/home">
                    <img src="{{ url_for('static', filename='logo-fedes-ascensores.png') }}" alt="FEDES Logo" class="logo">
                </a>
            </div>
        </div>
    </header>

    <main class="main--full-width">
        <div class="page-container">
            <!-- Buscador destacado -->
            <div class="buscador-destacado">
                <div class="buscador-label">Buscar Comunidad</div>
                <form action="{{ url_for('leads.dashboard') }}" method="GET" class="buscador-input-container">
                    <input
                        type="text"
                        name="search"
                        class="buscador-input"
                        placeholder="Escribe una direcciÃ³n, localidad o nombre..."
                        value="{{ request.args.get('search', '') }}"
                        autofocus
                    >
                    <button type="submit" class="btn-buscar">Buscar</button>
                </form>
            </div>

            <!-- MÃ©tricas -->
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-card__icon">ğŸ¢</div>
                    <div class="metric-card__value">
                        <a href="{{ url_for('leads.dashboard') }}">{{ metricas.total_comunidades }}</a>
                    </div>
                    <div class="metric-card__label">Instalaciones</div>
                </div>
                <div class="metric-card">
                    <div class="metric-card__icon">ğŸ”§</div>
                    <div class="metric-card__value">{{ metricas.total_equipos }}</div>
                    <div class="metric-card__label">Equipos</div>
                </div>
                <div class="metric-card">
                    <div class="metric-card__icon">ğŸ’°</div>
                    <div class="metric-card__value">
                        <a href="/oportunidades">{{ metricas.total_oportunidades }}</a>
                    </div>
                    <div class="metric-card__label">Oportunidades</div>
                </div>
            </div>

            <!-- Displays de Ãšltimas Instalaciones y Oportunidades -->
            <div class="recent-items-container">
                <!-- Ãšltimas 5 Instalaciones -->
                <div class="recent-items-display">
                    <h3>ğŸ“‹ Ãšltimas 5 Instalaciones</h3>
                    <div class="recent-items-list">
                        {% if ultimas_instalaciones %}
                            {% for instalacion in ultimas_instalaciones %}
                                <div class="recent-item">
                                    <a href="/ver_lead/{{ instalacion.id }}" class="recent-item__title">
                                        {{ instalacion.direccion }}{% if instalacion.nombre_cliente %} - {{ instalacion.nombre_cliente }}{% endif %}
                                    </a>
                                    <div class="recent-item__meta">
                                        <span class="recent-item__meta-item">{{ instalacion.localidad }}</span>
                                        <span class="recent-item__meta-item">Ascensores: {{ instalacion.num_equipos }}</span>
                                        <span class="recent-item__meta-item">{{ instalacion.empresa_mantenedora }}</span>
                                    </div>
                                </div>
                            {% endfor %}
                        {% else %}
                            <p class="text-secondary" style="padding: var(--space-xl);">No hay instalaciones registradas</p>
                        {% endif %}
                    </div>
                </div>

                <!-- Ãšltimas 5 Oportunidades -->
                <div class="recent-items-display">
                    <h3>ğŸ’¼ Ãšltimas 5 Oportunidades</h3>
                    <div class="recent-items-list">
                        {% if ultimas_oportunidades %}
                            {% for oportunidad in ultimas_oportunidades %}
                                <div class="recent-item d-flex align-center gap-sm flex-wrap">
                                    <div style="flex: 1; min-width: 0;">
                                        <a href="/ver_oportunidad/{{ oportunidad.id }}" class="recent-item__title">
                                            {{ oportunidad.direccion }} - {{ oportunidad.nombre_cliente }}
                                        </a>
                                        <span class="text-secondary d-block mt-sm">{{ oportunidad.tipo }}</span>
                                    </div>
                                    <span class="badge badge--{{ oportunidad.estado }}">
                                        {% if oportunidad.estado == 'nueva' %}ğŸ†• Nueva
                                        {% elif oportunidad.estado == 'en_contacto' %}ğŸ“ En contacto
                                        {% elif oportunidad.estado == 'presupuesto_preparacion' %}âœï¸ Presupuesto en preparaciÃ³n
                                        {% elif oportunidad.estado == 'presupuesto_enviado' %}ğŸ“¤ Presupuesto enviado
                                        {% elif oportunidad.estado == 'ganada' %}âœ… Ganada
                                        {% elif oportunidad.estado == 'perdida' %}âŒ Perdida
                                        {% elif oportunidad.estado == 'activa' %}âš¡ Activa
                                        {% else %}{{ oportunidad.estado|upper }}
                                        {% endif %}
                                    </span>
                                </div>
                            {% endfor %}
                        {% else %}
                            <p class="text-secondary" style="padding: var(--space-xl);">No hay oportunidades registradas</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Inyectar permisos del usuario para JavaScript -->
    <script>
        window.userPermissions = {{ permisos_usuario_json | safe }};
        window.perfilUsuario = '{{ perfil_usuario }}';
    </script>
    <script src="{{ url_for('static', filename='sidebar.js') }}"></script>
</body>
</html>
